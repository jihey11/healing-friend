<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì•„ë ì˜ ê°ì •ë³„ - ì •ì‹ ê±´ê°• ì¼€ì–´ë¥¼ ìœ„í•œ AI ìºë¦­í„°ì™€ í•¨ê»˜í•˜ëŠ” ì¼ê¸°, ëŒ€í™”, ê²Œì„ ì„œë¹„ìŠ¤">
    <title>ì•„ë ì˜ ê°ì •ë³„ - ì •ì‹ ê±´ê°• ì¼€ì–´</title>
    
    <!-- Favicon ì„¤ì • -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒŸ</text></svg>">
    
    <!-- CSS íŒŒì¼ë“¤ -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/character.css">
    <link rel="stylesheet" href="css/game.css">
    
    <!-- í™˜ê²½ë³€ìˆ˜ ì„¤ì • (Netlify ë¹Œë“œ ì‹œ ì£¼ì…ë¨) -->
    <script>
        // ë¡œì»¬ ê°œë°œìš© ê¸°ë³¸ê°’ (ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©)
        // Netlify ë°°í¬ ì‹œ build-netlify.jsê°€ ì´ ë¶€ë¶„ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ êµì²´í•©ë‹ˆë‹¤
        window.ENV = {
            // ë°±ì—”ë“œ API URL (Railway ë°°í¬ URL)
            API_URL: "http://localhost:3000",
            
            // Firebase ì„¤ì • (ë¡œì»¬ ê°œë°œ ì‹œ ì‚¬ìš©)
            // ì±„íŒ… ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì•„ë˜ ê°’ë“¤ì„ Firebase Consoleì—ì„œ ê°€ì ¸ì™€ì„œ ì…ë ¥í•˜ì„¸ìš”
            // ì„¤ì • ë°©ë²•: CHAT_FIREBASE_SETUP.md íŒŒì¼ ì°¸ê³ 
            // 
            // 1. Firebase Console > í”„ë¡œì íŠ¸ ì„¤ì •(âš™ï¸) > ë‚´ ì•± > ì›¹ ì•± ì„¤ì •ì—ì„œ ë³µì‚¬
            // 2. ì•„ë˜ ê°’ë“¤ì„ ì‹¤ì œ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”
            FIREBASE_API_KEY: "AIzaSyBo_9CNsDaPyNiJVFkpkuV6vBghC-oKJqw",
            FIREBASE_AUTH_DOMAIN: "healing-friend.firebaseapp.com",
            FIREBASE_PROJECT_ID: "healing-friend",  // í”„ë¡œì íŠ¸ IDëŠ” ì´ë¯¸ í™•ì¸ë¨
            FIREBASE_STORAGE_BUCKET: "healing-friend.firebasestorage.app",
            FIREBASE_MESSAGING_SENDER_ID: "903142131790",
            FIREBASE_APP_ID: "1:903142131790:web:c2e414321180b92b6adb1f",
            
            // Firebase Realtime Database URL (ì±„íŒ… ê¸°ëŠ¥ì— í•„ìš”)
            // Firebase Console > Realtime Databaseì—ì„œ URL í™•ì¸ í›„ ì•„ë˜ì— ì…ë ¥í•˜ì„¸ìš”
            // í˜•ì‹: https://í”„ë¡œì íŠ¸ID-default-rtdb.firebaseio.com/
            FIREBASE_DATABASE_URL: "https://healing-friend-default-rtdb.firebaseio.com/"
            
            // ì£¼ì˜: OpenAI API í‚¤ëŠ” ì ˆëŒ€ í”„ë¡ íŠ¸ì—”ë“œì— ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”!
            // ëª¨ë“  AI API í˜¸ì¶œì€ ìœ„ì˜ API_URL (ë°±ì—”ë“œ ì„œë²„)ë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
        };
        
        // FIREBASE_DATABASE_URLì´ ì—†ìœ¼ë©´ ì¦‰ì‹œ ìë™ ìƒì„± (ê°ì²´ ì •ì˜ ì§í›„)
        if (!window.ENV.FIREBASE_DATABASE_URL && window.ENV.FIREBASE_PROJECT_ID) {
            window.ENV.FIREBASE_DATABASE_URL = `https://${window.ENV.FIREBASE_PROJECT_ID}-default-rtdb.firebaseio.com/`;
        }
        
        // Firebase ì„¤ì • í™•ì¸ (ë””ë²„ê¹…ìš©)
        console.log('Firebase ì„¤ì • í™•ì¸:', {
            hasApiKey: !!window.ENV.FIREBASE_API_KEY,
            hasAuthDomain: !!window.ENV.FIREBASE_AUTH_DOMAIN,
            hasProjectId: !!window.ENV.FIREBASE_PROJECT_ID,
            hasStorageBucket: !!window.ENV.FIREBASE_STORAGE_BUCKET,
            hasMessagingSenderId: !!window.ENV.FIREBASE_MESSAGING_SENDER_ID,
            hasAppId: !!window.ENV.FIREBASE_APP_ID,
            hasDatabaseURL: !!window.ENV.FIREBASE_DATABASE_URL,
            databaseURL: window.ENV.FIREBASE_DATABASE_URL
        });
    </script>

    <!-- Firebase SDK CDN (v9 modular) -->
    <script type="module">
        // Firebase ëª¨ë“ˆë“¤ì„ ë™ì ìœ¼ë¡œ ë¡œë“œ (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
        let retryCount = 0;
        const MAX_RETRIES = 3;
        const RETRY_DELAY = 2000; // 2ì´ˆ
        
        async function loadFirebaseModules() {
            try {
                console.log(`Firebase ëª¨ë“ˆ ë¡œë“œ ì‹œë„ ${retryCount + 1}/${MAX_RETRIES + 1}`);
                
                // Firebase ëª¨ë“ˆë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ë¡œë“œ
                const appModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const authModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                const firestoreModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const databaseModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
                
                // Firebase í•¨ìˆ˜ë“¤ì„ window ê°ì²´ì— ì €ì¥
                window.firebaseModules = {
                    initializeApp: appModule.initializeApp,
                    getApp: appModule.getApp,
                    getApps: appModule.getApps,
                    getAuth: authModule.getAuth,
                    getFirestore: firestoreModule.getFirestore,
                    getDatabase: databaseModule.getDatabase,
                    ref: databaseModule.ref,
                    set: databaseModule.set,
                    push: databaseModule.push,
                    onValue: databaseModule.onValue,
                    off: databaseModule.off,
                    onDisconnect: databaseModule.onDisconnect,
                    remove: databaseModule.remove,
                    // Auth í•¨ìˆ˜ë“¤ë„ ì§ì ‘ ì €ì¥
                    createUserWithEmailAndPassword: authModule.createUserWithEmailAndPassword,
                    signInWithEmailAndPassword: authModule.signInWithEmailAndPassword,
                    signOut: authModule.signOut,
                    onAuthStateChanged: authModule.onAuthStateChanged,
                    setPersistence: authModule.setPersistence,
                    browserLocalPersistence: authModule.browserLocalPersistence,
                    browserSessionPersistence: authModule.browserSessionPersistence,
                    // Firestore í•¨ìˆ˜ë“¤ë„ ì§ì ‘ ì €ì¥
                    doc: firestoreModule.doc,
                    setDoc: firestoreModule.setDoc,
                    getDoc: firestoreModule.getDoc,
                    collection: firestoreModule.collection,
                    addDoc: firestoreModule.addDoc,
                    serverTimestamp: firestoreModule.serverTimestamp
                };
                
                console.log('âœ… Firebase ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
                retryCount = 0; // ì„±ê³µ ì‹œ ì¬ì‹œë„ ì¹´ìš´íŠ¸ ë¦¬ì…‹
                
                // Firebase ì´ˆê¸°í™” ì´ë²¤íŠ¸ ë°œìƒ
                window.dispatchEvent(new CustomEvent('firebaseModulesLoaded'));
                
            } catch (error) {
                console.error(`âŒ Firebase ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨ (ì‹œë„ ${retryCount + 1}/${MAX_RETRIES + 1}):`, error);
                
                // ì¬ì‹œë„ ë¡œì§
                if (retryCount < MAX_RETRIES) {
                    retryCount++;
                    console.log(`${RETRY_DELAY / 1000}ì´ˆ í›„ ì¬ì‹œë„...`);
                    setTimeout(() => {
                        loadFirebaseModules();
                    }, RETRY_DELAY);
                } else {
                    // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼
                    console.error('Firebase ëª¨ë“ˆ ë¡œë“œ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼');
                    window.firebaseModules = null;
                    
                    // Firebase ë¡œë“œ ì‹¤íŒ¨ ì´ë²¤íŠ¸ ë°œìƒ
                    window.dispatchEvent(new CustomEvent('firebaseModulesFailed', { detail: error }));
                }
            }
        }
        
        // Firebase ëª¨ë“ˆ ë¡œë“œ ì‹œì‘
        loadFirebaseModules();
    </script>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading-screen" class="loading-screen">
        <div class="spinner"></div>
        <p>ë¡œë”© ì¤‘...</p>
    </div>

    <!-- ì¸ì¦ í™”ë©´ -->
    <div id="auth-container" class="auth-container hidden">
        <div class="auth-card">
            <h1>ğŸŒŸ ì•„ë ì˜ ê°ì •ë³„</h1>
            
            <!-- íƒ­ -->
            <div class="tab-buttons">
                <button id="login-tab" class="tab-btn active">ë¡œê·¸ì¸</button>
                <button id="signup-tab" class="tab-btn">íšŒì›ê°€ì…</button>
            </div>
            
            <!-- ë¡œê·¸ì¸ í¼ -->
            <form id="login-form" class="auth-form">
                <input type="email" id="login-email" placeholder="ì´ë©”ì¼" required>
                <input type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
                <label>
                    <input type="checkbox" id="remember-me">
                    <span>ìë™ ë¡œê·¸ì¸</span>
                </label>
                <button type="submit">ë¡œê·¸ì¸</button>
                <p class="error-msg" id="login-error"></p>
            </form>
            
            <!-- íšŒì›ê°€ì… í¼ -->
            <form id="signup-form" class="auth-form hidden">
                <input type="email" id="signup-email" placeholder="ì´ë©”ì¼" required>
                <input type="password" id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" required minlength="6">
                <input type="password" id="signup-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
                <input type="text" id="signup-nickname" placeholder="ë‹‰ë„¤ì„" required maxlength="10">
                <input type="text" id="signup-character-name" placeholder="ìºë¦­í„° ì´ë¦„" required maxlength="10">
                <button type="submit">íšŒì›ê°€ì…</button>
                <p class="error-msg" id="signup-error"></p>
            </form>
        </div>
    </div>

    <!-- ë©”ì¸ ì•± -->
    <div id="app" class="app hidden">
        <!-- í—¤ë” -->
        <header class="header">
            <div class="logo">ğŸŒŸ ì•„ë ì˜ ê°ì •ë³„</div>
            <div class="header-info">
                <span id="next-diary-time">ì¼ê¸° ì‘ì„± ê°€ëŠ¥</span>
            </div>
        </header>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- í™ˆ í™”ë©´ -->
            <div id="home-view" class="view active">
                <div class="home-layout">
                    <!-- ì™¼ìª½: ìºë¦­í„° ì˜ì—­ -->
                    <div class="home-left">
                        <div class="character-container">
                            <canvas id="character-canvas" width="400" height="400"></canvas>
                            <div id="speech-bubble" class="speech-bubble hidden">
                                <p id="speech-text"></p>
                            </div>
                        </div>
                        <div class="character-info">
                    <div class="level-bar">
                        <span>Lv.<span id="character-level">1</span></span>
                        <div class="exp-bar">
                            <div id="exp-fill" class="exp-fill"></div>
                        </div>
                        <span id="exp-text">0/100</span>
                    </div>
                    <!-- ê´€ë¦¬ì ë„êµ¬ (ê´€ë¦¬ìë§Œ í‘œì‹œ) -->
                    <div style="margin-top: 12px;">
                        <div id="admin-evolve-group" class="hidden" style="display: grid; gap: 10px; grid-template-columns: 1fr; background: #fff; border: 1px solid var(--color-border); border-radius: 12px; padding: 12px;">
                            <!-- ì„¹ì…˜: ìë™ ì§„í™” -->
                            <div style="display: grid; gap: 8px;">
                                <div style="font-weight: 700; font-size: 13px; color: var(--color-text);">ìë™ ì§„í™”</div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <button id="admin-evolve-1" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">1ë‹¨ê³„ (ìµœê³  ê°ì •)</button>
                                    <button id="admin-evolve-2" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">2ë‹¨ê³„ (ìµœê³  ê°ì •)</button>
                                    <button id="admin-evolve-3" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">3ë‹¨ê³„ (ìµœê³  ê°ì •)</button>
                                </div>
                            </div>

                            <!-- ì„¹ì…˜: ì„ íƒ ê°ì • ì§„í™” -->
                            <div style="display: grid; gap: 8px;">
                                <div style="font-weight: 700; font-size: 13px; color: var(--color-text);">ì„ íƒ ê°ì • ì§„í™”</div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                                    <label for="admin-emotion-select" style="font-size: 12px; color: var(--color-text-light);">ê°ì •</label>
                                    <select id="admin-emotion-select" style="padding: 8px 10px; border-radius: 10px; background: white; border: 1px solid var(--color-border);">
                                        <option value="ê¸°ì¨">ê¸°ì¨</option>
                                        <option value="ìŠ¬í””">ìŠ¬í””</option>
                                        <option value="ë¶„ë…¸">ë¶„ë…¸</option>
                                        <option value="ë‘ë ¤ì›€">ë‘ë ¤ì›€</option>
                                        <option value="ë†€ëŒ">ë†€ëŒ</option>
                                        <option value="í˜ì˜¤">í˜ì˜¤</option>
                                    </select>
                                    <button id="admin-evolve-1-custom" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">1ë‹¨ê³„</button>
                                    <button id="admin-evolve-2-custom" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">2ë‹¨ê³„(í‘œì •)</button>
                                    <button id="admin-evolve-3-custom" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">3ë‹¨ê³„</button>
                                </div>
                            </div>

                            <!-- ì„¹ì…˜: ê¸°ë³¸/ì´ˆê¸°í™” -->
                            <div style="display: flex; gap: 8px; justify-content: space-between; align-items: center;">
                                <div style="display: flex; gap: 8px;">
                                    <button id="admin-revert-base" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">ê¸°ë³¸ëª¨ìŠµ</button>
                                </div>
                                <button id="admin-reset-btn" class="btn-danger hidden" style="padding: 8px 14px; border-radius: 10px;">ì´ˆê¸°í™” (ê´€ë¦¬ì)</button>
                            </div>
                        </div>
                    </div>
                    <!-- ê´€ë¦¬ì ì „ìš© ê°ì • ì ìˆ˜ í‘œì‹œ -->
                    <div id="emotion-scores" class="emotion-scores hidden">
                        <h3>ê°ì • ì ìˆ˜</h3>
                        <div class="emotion-grid">
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜Š</span>
                                <span class="emotion-name">ê¸°ì¨</span>
                                <span class="emotion-value" id="emotion-joy">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜¢</span>
                                <span class="emotion-name">ìŠ¬í””</span>
                                <span class="emotion-value" id="emotion-sadness">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜¡</span>
                                <span class="emotion-name">ë¶„ë…¸</span>
                                <span class="emotion-value" id="emotion-anger">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜°</span>
                                <span class="emotion-name">ë‘ë ¤ì›€</span>
                                <span class="emotion-value" id="emotion-fear">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜²</span>
                                <span class="emotion-name">ë†€ëŒ</span>
                                <span class="emotion-value" id="emotion-surprise">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜–</span>
                                <span class="emotion-name">í˜ì˜¤</span>
                                <span class="emotion-value" id="emotion-disgust">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì˜¤ëŠ˜ì˜ íŒ (í™ˆ íƒ­ ì „ìš©) -->
                    <div class="tip-banner">
                        <span>ğŸ’¡</span>
                        <p id="daily-tip"></p>
                    </div>
                        </div>
                    </div>
                    
                    <!-- ì˜¤ë¥¸ìª½: ì±„íŒ… ì˜ì—­ -->
                    <div class="home-right">
                        <div class="home-chat-container">
                            <div class="home-chat-header">
                                <h3>ğŸ’¬ ì¹œêµ¬ì™€ ëŒ€í™”í•˜ê¸°</h3>
                            </div>
                            <div class="home-chat-messages" id="home-chat-messages">
                                <div class="chat-message bot">
                                    <div class="message-bubble">ì•ˆë…•! ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë•Œ? ğŸ˜Š</div>
                                </div>
                            </div>
                            <div class="home-chat-input-container">
                                <input type="text" id="home-chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." maxlength="500">
                                <button id="home-chat-send">ì „ì†¡</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì¼ê¸° í™”ë©´ -->
            <div id="diary-view" class="view">
                <div class="diary-layout">
                    <!-- ì™¼ìª½: ì¼ê¸° ì‘ì„± -->
                    <div class="diary-left">
                        <div class="diary-container">
                            <h2>ì˜¤ëŠ˜ì˜ ê¸°ë¶„</h2>
                            <div class="emotion-selector">
                                <button class="emotion-btn" data-emotion="ê¸°ì¨">ğŸ˜Š</button>
                                <button class="emotion-btn" data-emotion="ìŠ¬í””">ğŸ˜¢</button>
                                <button class="emotion-btn" data-emotion="ë¶„ë…¸">ğŸ˜¡</button>
                                <button class="emotion-btn" data-emotion="ë‘ë ¤ì›€">ğŸ˜°</button>
                                <button class="emotion-btn" data-emotion="ë†€ëŒ">ğŸ˜²</button>
                                <button class="emotion-btn" data-emotion="í˜ì˜¤">ğŸ˜–</button>
                            </div>
                            <textarea id="diary-content" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë• ë‚˜ìš”? (ìµœì†Œ 10ì)" maxlength="1000"></textarea>
                            <div class="char-count"><span id="char-count">0</span></div>
                            <div class="diary-actions">
                                <button id="diary-cancel" class="btn-secondary">ì·¨ì†Œ</button>
                                <button id="diary-save" class="btn-primary" disabled>ì €ì¥</button>
                            </div>
                            <p class="error-msg" id="diary-error"></p>
                        </div>
                    </div>
                    
                    <!-- ì˜¤ë¥¸ìª½: ì¼ê¸° ëª©ë¡ -->
                    <div class="diary-right">
                        <div class="diary-list-container">
                            <div class="diary-list-header">
                                <div class="diary-list-title-wrapper">
                                    <button id="diary-list-toggle" class="toggle-btn" aria-label="ì¼ê¸° ëª©ë¡ ì ‘ê¸°/í¼ì¹˜ê¸°">
                                        <span class="toggle-icon">â–¼</span>
                                    </button>
                                    <h3>ğŸ“– ì¼ê¸° ëª©ë¡</h3>
                                </div>
                                <button id="load-diary-btn" class="btn-secondary">ìƒˆë¡œê³ ì¹¨</button>
                            </div>
                            <div id="diary-list" class="diary-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê²Œì„ ì„ íƒ í™”ë©´ -->
            <div id="game-view" class="view">
                <div class="game-selector">
                    <div class="game-card" id="target-game-card">
                        <h3>ğŸ¯ ê³¼ë… ë§ì¶”ê¸°</h3>
                        <p>ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ</p>
                        <p class="game-count">ì˜¤ëŠ˜ <span id="target-plays">0</span>/5 í”Œë ˆì´</p>
                        <button class="btn-primary">ì‹œì‘í•˜ê¸°</button>
                    </div>
                    <div class="game-card" id="puzzle-game-card">
                        <h3>ğŸ§© ìŠ¬ë¼ì´ë”© í¼ì¦</h3>
                        <p>ë§ˆìŒ ì±™ê¹€</p>
                        <p class="game-count">ì˜¤ëŠ˜ <span id="puzzle-plays">0</span>/5 í”Œë ˆì´</p>
                        <button class="btn-primary">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ë§ˆì´í˜ì´ì§€ -->
            <div id="mypage-view" class="view">
                <div class="mypage-container">
                    <section class="profile-section">
                        <h2>í”„ë¡œí•„</h2>
                        <p>ë‹‰ë„¤ì„: <span id="user-nickname"></span></p>
                        <p>ìºë¦­í„°: <span id="character-name"></span></p>
                        <p>í•¨ê»˜í•œ ì§€ <span id="days-count">0</span>ì¼</p>
                    </section>
                    
                    <section class="stats-section">
                        <h2>í†µê³„</h2>
                        <p>ë ˆë²¨: <span id="stats-level">1</span></p>
                        <p>ì§„í™” ë‹¨ê³„: <span id="stats-evolution">0</span></p>
                        <p>ì´ ì¼ê¸°: <span id="stats-diaries">0</span>ê°œ</p>
                    </section>
                    
                    <section class="settings-section">
                        <h2>ì„¤ì •</h2>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="notification-toggle">
                                <span>ì•Œë¦¼ ë°›ê¸°</span>
                            </label>
                        </div>
                        <button id="logout-btn" class="btn-secondary" style="margin-top: 16px;">ë¡œê·¸ì•„ì›ƒ</button>
                    </section>
                </div>
            </div>
            
            <!-- ìŒì‹ í™”ë©´ -->
            <div id="food-view" class="view">
                <div class="food-container">
                    <div class="food-header">
                        <h2>ğŸ½ï¸ ìŒì‹ ì¸ë²¤í† ë¦¬</h2>
                        <p class="food-count">ë³´ìœ : <span id="total-food-count">0</span>ê°œ</p>
                    </div>
                    
                    <div class="food-filter">
                        <button class="filter-btn active" data-filter="all">ì „ì²´</button>
                        <button class="filter-btn" data-filter="ê¸°ì¨">ğŸ˜Š ê¸°ì¨</button>
                        <button class="filter-btn" data-filter="ìŠ¬í””">ğŸ˜¢ ìŠ¬í””</button>
                        <button class="filter-btn" data-filter="ë¶„ë…¸">ğŸ˜¡ ë¶„ë…¸</button>
                        <button class="filter-btn" data-filter="ë‘ë ¤ì›€">ğŸ˜° ë‘ë ¤ì›€</button>
                        <button class="filter-btn" data-filter="ë†€ëŒ">ğŸ˜² ë†€ëŒ</button>
                        <button class="filter-btn" data-filter="í˜ì˜¤">ğŸ˜– í˜ì˜¤</button>
                    </div>
                    
                    <div id="food-grid" class="food-grid">
                        <!-- ë™ì ìœ¼ë¡œ ìŒì‹ ì¹´ë“œ ìƒì„± -->
                    </div>
                    
                    <div id="food-empty" class="food-empty hidden">
                        <p class="empty-icon">ğŸ½ï¸</p>
                        <p class="empty-text">ì•„ì§ ìŒì‹ì´ ì—†ì–´ìš”</p>
                        <p class="empty-hint">ê²Œì„ì„ í”Œë ˆì´í•´ì„œ ìŒì‹ì„ ì–»ì–´ë³´ì„¸ìš”!</p>
                    </div>
                </div>
            </div>

            <!-- ì±„íŒ… í™”ë©´ -->
            <div id="chat-view" class="view">
                <!-- ë‹‰ë„¤ì„ ì…ë ¥ (ì²˜ìŒ ì ‘ì† ì‹œ) -->
                <div id="chat-nickname-section" class="chat-nickname-section hidden">
                    <div class="chat-nickname-card">
                        <h2>ì±„íŒ…ë°© ì…ì¥</h2>
                        <input type="text" id="chat-nickname-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20" />
                        <input type="file" id="chat-profile-image-input" accept="image/*" />
                        <button class="btn-primary" onclick="window.chatRoomManager?.saveNickname()">í™•ì¸</button>
                    </div>
                </div>

                <!-- ì±„íŒ…ë°© ëª©ë¡ -->
                <div id="chat-room-selection" class="chat-room-selection">
                    <div class="chat-room-header">
                        <h2>ğŸ’¬ ì±„íŒ…ë°© ëª©ë¡</h2>
                        <button class="btn-primary" onclick="window.chatRoomManager?.showCreateRoomForm()">â• ë°© ë§Œë“¤ê¸°</button>
                    </div>
                    <input type="text" id="chat-search-room" placeholder="ì±„íŒ…ë°© ê²€ìƒ‰..." />
                    <div id="chat-room-list-container" class="chat-room-list-container"></div>
                </div>

                <!-- ì±„íŒ…ë°© ìƒì„± -->
                <div id="chat-create-room-form" class="chat-create-room-form hidden">
                    <div class="chat-create-room-card">
                        <h2>âœ¨ ìƒˆ ì±„íŒ…ë°© ë§Œë“¤ê¸°</h2>
                        <div class="form-group">
                            <label for="chat-new-room-name">ë°© ì´ë¦„</label>
                            <input type="text" id="chat-new-room-name" placeholder="ë°© ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="30" />
                        </div>
                        <div class="form-group">
                            <label for="chat-new-room-image">ë°© ì´ë¯¸ì§€ (ì„ íƒ)</label>
                            <input type="file" id="chat-new-room-image" accept="image/*" />
                        </div>
                        <div class="form-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="chat-use-password" />
                                <span>ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</span>
                            </label>
                        </div>
                        <div class="form-group password-group hidden" id="password-input-group">
                            <label for="chat-new-room-password">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="chat-new-room-password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" maxlength="20" />
                        </div>
                        <div class="chat-create-room-buttons">
                            <button class="btn-primary" onclick="window.chatRoomManager?.createRoom()">ë°© ë§Œë“¤ê¸°</button>
                            <button class="btn-secondary" onclick="window.chatRoomManager?.cancelCreateRoom()">ì·¨ì†Œ</button>
                        </div>
                    </div>
                </div>

                <!-- ì±„íŒ… í™”ë©´ -->
                <div id="chat-section" class="chat-layout hidden">
                    <!-- ì‚¬ì´ë“œë°” -->
                    <div class="chat-sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-title">ì±„íŒ…ë°© ëª©ë¡</div>
                            <button class="btn-primary btn-small" onclick="window.chatRoomManager?.showCreateRoomForm()">â•</button>
                        </div>
                        <div class="sidebar-rooms" id="chat-sidebar-room-list"></div>
                    </div>

                    <!-- ë©”ì¸ ì±„íŒ… -->
                    <div class="chat-main">
                        <div class="chat-header">
                            <div class="chat-header-info">
                                <img id="chat-room-profile" class="chat-room-profile" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23ddd'/%3E%3Ctext x='50' y='60' text-anchor='middle' font-size='40' fill='%23999'%3EğŸ‘¤%3C/text%3E%3C/svg%3E" alt="ì±„íŒ…ë°© í”„ë¡œí•„">
                                <div class="chat-room-title" id="chat-room-title">ì±„íŒ…ë°©</div>
                            </div>
                            <button class="back-button" onclick="window.chatRoomManager?.exitRoom()">&#x276E;</button>
                        </div>

                        <div id="chat-box" class="chat-box"></div>
                        <div id="chat-typing-indicator" class="typing-indicator"></div>

                        <!-- ì±„íŒ… ì…ë ¥ì°½ -->
                        <div class="chat-input-bar">
                            <input type="file" id="chat-file-input" accept="image/*,video/*" style="display: none;" />
                            <button class="chat-icon-btn" onclick="document.getElementById('chat-file-input').click()">ğŸ“</button>
                            <input type="text" id="chat-message-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." maxlength="1000" />
                            <span class="char-counter" id="chat-char-counter">0/1000</span>
                            <button class="send-btn" onclick="window.chatRoomManager?.sendMessage()">â¤</button>
                        </div>

                        <button class="clear-button" onclick="window.chatRoomManager?.clearRoom()">ğŸ§¹ ì±„íŒ…ë°© ì´ˆê¸°í™”</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-view="home">
                <span>ğŸ </span>
                <span>í™ˆ</span>
            </button>
            <button class="nav-btn" data-view="diary">
                <span>ğŸ“</span>
                <span>ì¼ê¸°</span>
            </button>
            <button class="nav-btn" data-view="game">
                <span>ğŸ®</span>
                <span>ê²Œì„</span>
            </button>
            <button class="nav-btn" data-view="chat">
                <span>ğŸ’¬</span>
                <span>ì±„íŒ…</span>
            </button>
            <button class="nav-btn" data-view="food">
                <span>ğŸ½ï¸</span>
                <span>ìŒì‹</span>
            </button>
            <button class="nav-btn" data-view="mypage">
                <span>ğŸ‘¤</span>
                <span>ë§ˆì´</span>
            </button>
        </nav>
    </div>

    <!-- ëª¨ë‹¬ë“¤ -->
    <div id="modal-overlay" class="modal-overlay hidden"></div>
    
    <!-- ê²Œì„ ëª¨ë‹¬ -->
    <div id="game-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <div id="game-container"></div>
        </div>
    </div>

    <!-- ì¼ê¸° ìƒì„¸ ëª¨ë‹¬ -->
    <div id="diary-detail-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <div id="diary-detail-content"></div>
        </div>
    </div>

    <!-- ì•Œë¦¼ í† ìŠ¤íŠ¸ -->
    <div id="toast" class="toast hidden"></div>

    <!-- JavaScript íŒŒì¼ë“¤ (type="module"ë¡œ ë¡œë“œ) -->
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/character.js"></script>
    <script type="module" src="js/diary.js"></script>
    <script type="module" src="js/chat.js"></script>
    <script type="module" src="js/chat-room.js"></script>
    <script type="module" src="js/tutorial.js"></script>
    <script type="module" src="js/game-target.js"></script>
    <script type="module" src="js/game-puzzle.js"></script>
    <script type="module" src="js/food.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
