<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì•„ë ì˜ ê°ì •ë³„ - ì •ì‹ ê±´ê°• ì¼€ì–´ë¥¼ ìœ„í•œ AI ìºë¦­í„°ì™€ í•¨ê»˜í•˜ëŠ” ì¼ê¸°, ëŒ€í™”, ê²Œì„ ì„œë¹„ìŠ¤">
    <title>ì•„ë ì˜ ê°ì •ë³„ - ì •ì‹ ê±´ê°• ì¼€ì–´</title>
    
    <!-- Favicon ì„¤ì • -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒŸ</text></svg>">
    
    <!-- CSS íŒŒì¼ë“¤ -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/character.css">
    <link rel="stylesheet" href="css/game.css">
    
    <!-- í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ë¡œì»¬ ê°œë°œìš©) -->
    <script>
        // ë¡œì»¬ ê°œë°œìš© ì„¤ì •
        window.ENV = {
            // ë°±ì—”ë“œ API URL (ë¡œì»¬ ê°œë°œ ì„œë²„)
            API_URL: "http://localhost:3000",
            
            // Firebase ì„¤ì • (ë¡œì»¬ ê°œë°œ ì‹œ ì„ íƒì‚¬í•­)
            FIREBASE_API_KEY: "your_firebase_api_key_here",
            FIREBASE_AUTH_DOMAIN: "your-project.firebaseapp.com",
            FIREBASE_PROJECT_ID: "your-project-id",
            FIREBASE_STORAGE_BUCKET: "your-project.appspot.com",
            FIREBASE_MESSAGING_SENDER_ID: "your_sender_id",
            FIREBASE_APP_ID: "your_app_id",
            
            // OpenAI API í‚¤ëŠ” ë°±ì—”ë“œì—ì„œë§Œ ì‚¬ìš© (ì—¬ê¸°ì— ë„£ì§€ ë§ˆì„¸ìš”!)
            OPENAI_API_KEY: ""
        };
    </script>

    <!-- Firebase SDK CDN (v9 modular) -->
    <script type="module">
        // Firebase ëª¨ë“ˆë“¤ì„ ë™ì ìœ¼ë¡œ ë¡œë“œ
        async function loadFirebaseModules() {
            try {
                // Firebase ëª¨ë“ˆë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ë¡œë“œ
                const appModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const authModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                const firestoreModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                // Firebase í•¨ìˆ˜ë“¤ì„ window ê°ì²´ì— ì €ì¥
                window.firebaseModules = {
                    initializeApp: appModule.initializeApp,
                    getAuth: authModule.getAuth,
                    getFirestore: firestoreModule.getFirestore,
                    // Auth í•¨ìˆ˜ë“¤ë„ ì§ì ‘ ì €ì¥
                    createUserWithEmailAndPassword: authModule.createUserWithEmailAndPassword,
                    signInWithEmailAndPassword: authModule.signInWithEmailAndPassword,
                    signOut: authModule.signOut,
                    onAuthStateChanged: authModule.onAuthStateChanged,
                    // Firestore í•¨ìˆ˜ë“¤ë„ ì§ì ‘ ì €ì¥
                    doc: firestoreModule.doc,
                    setDoc: firestoreModule.setDoc,
                    getDoc: firestoreModule.getDoc,
                    serverTimestamp: firestoreModule.serverTimestamp
                };
                
                console.log('Firebase ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
                
                // Firebase ì´ˆê¸°í™” ì´ë²¤íŠ¸ ë°œìƒ
                window.dispatchEvent(new CustomEvent('firebaseModulesLoaded'));
                
            } catch (error) {
                console.error('Firebase ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:', error);
                window.firebaseModules = null;
                
                // Firebase ë¡œë“œ ì‹¤íŒ¨ ì´ë²¤íŠ¸ ë°œìƒ
                window.dispatchEvent(new CustomEvent('firebaseModulesFailed', { detail: error }));
            }
        }
        
        // Firebase ëª¨ë“ˆ ë¡œë“œ ì‹œì‘
        loadFirebaseModules();
    </script>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading-screen" class="loading-screen">
        <div class="spinner"></div>
        <p>ë¡œë”© ì¤‘...</p>
    </div>

    <!-- ì¸ì¦ í™”ë©´ -->
    <div id="auth-container" class="auth-container hidden">
        <div class="auth-card">
            <h1>ğŸŒŸ ì•„ë ì˜ ê°ì •ë³„</h1>
            
            <!-- íƒ­ -->
            <div class="tab-buttons">
                <button id="login-tab" class="tab-btn active">ë¡œê·¸ì¸</button>
                <button id="signup-tab" class="tab-btn">íšŒì›ê°€ì…</button>
            </div>
            
            <!-- ë¡œê·¸ì¸ í¼ -->
            <form id="login-form" class="auth-form">
                <input type="email" id="login-email" placeholder="ì´ë©”ì¼" required>
                <input type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
                <label>
                    <input type="checkbox" id="remember-me">
                    <span>ìë™ ë¡œê·¸ì¸</span>
                </label>
                <button type="submit">ë¡œê·¸ì¸</button>
                <p class="error-msg" id="login-error"></p>
            </form>
            
            <!-- íšŒì›ê°€ì… í¼ -->
            <form id="signup-form" class="auth-form hidden">
                <input type="email" id="signup-email" placeholder="ì´ë©”ì¼" required>
                <input type="password" id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" required minlength="6">
                <input type="password" id="signup-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
                <input type="text" id="signup-nickname" placeholder="ë‹‰ë„¤ì„" required maxlength="10">
                <input type="text" id="signup-character-name" placeholder="ìºë¦­í„° ì´ë¦„" required maxlength="10">
                <button type="submit">íšŒì›ê°€ì…</button>
                <p class="error-msg" id="signup-error"></p>
            </form>
        </div>
    </div>

    <!-- ë©”ì¸ ì•± -->
    <div id="app" class="app hidden">
        <!-- í—¤ë” -->
        <header class="header">
            <div class="logo">ğŸŒŸ ì•„ë ì˜ ê°ì •ë³„</div>
            <div class="header-info">
                <span id="next-diary-time">ì¼ê¸° ì‘ì„± ê°€ëŠ¥</span>
            </div>
        </header>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- í™ˆ í™”ë©´ -->
            <div id="home-view" class="view active">
                <div class="character-container">
                    <canvas id="character-canvas" width="520" height="520"></canvas>
                    <div id="speech-bubble" class="speech-bubble hidden">
                        <p id="speech-text"></p>
                    </div>
                </div>
                <div class="character-info">
                    <div class="level-bar">
                        <span>Lv.<span id="character-level">1</span></span>
                        <div class="exp-bar">
                            <div id="exp-fill" class="exp-fill"></div>
                        </div>
                        <span id="exp-text">0/100</span>
                    </div>
                    <!-- ê´€ë¦¬ì ë„êµ¬ (ê´€ë¦¬ìë§Œ í‘œì‹œ) -->
                    <div style="margin-top: 12px;">
                        <div id="admin-evolve-group" class="hidden" style="display: grid; gap: 10px; grid-template-columns: 1fr; background: #fff; border: 1px solid var(--color-border); border-radius: 12px; padding: 12px;">
                            <!-- ì„¹ì…˜: ìë™ ì§„í™” -->
                            <div style="display: grid; gap: 8px;">
                                <div style="font-weight: 700; font-size: 13px; color: var(--color-text);">ìë™ ì§„í™”</div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <button id="admin-evolve-1" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">1ë‹¨ê³„ (ìµœê³  ê°ì •)</button>
                                    <button id="admin-evolve-2" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">2ë‹¨ê³„ (ìµœê³  ê°ì •)</button>
                                    <button id="admin-evolve-3" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">3ë‹¨ê³„ (ìµœê³  ê°ì •)</button>
                                </div>
                            </div>

                            <!-- ì„¹ì…˜: ì„ íƒ ê°ì • ì§„í™” -->
                            <div style="display: grid; gap: 8px;">
                                <div style="font-weight: 700; font-size: 13px; color: var(--color-text);">ì„ íƒ ê°ì • ì§„í™”</div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                                    <label for="admin-emotion-select" style="font-size: 12px; color: var(--color-text-light);">ê°ì •</label>
                                    <select id="admin-emotion-select" style="padding: 8px 10px; border-radius: 10px; background: white; border: 1px solid var(--color-border);">
                                        <option value="ê¸°ì¨">ê¸°ì¨</option>
                                        <option value="ìŠ¬í””">ìŠ¬í””</option>
                                        <option value="ë¶„ë…¸">ë¶„ë…¸</option>
                                        <option value="ë‘ë ¤ì›€">ë‘ë ¤ì›€</option>
                                        <option value="ë†€ëŒ">ë†€ëŒ</option>
                                        <option value="í˜ì˜¤">í˜ì˜¤</option>
                                    </select>
                                    <button id="admin-evolve-1-custom" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">1ë‹¨ê³„</button>
                                    <button id="admin-evolve-2-custom" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">2ë‹¨ê³„(í‘œì •)</button>
                                    <button id="admin-evolve-3-custom" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">3ë‹¨ê³„</button>
                                </div>
                            </div>

                            <!-- ì„¹ì…˜: ê¸°ë³¸/ì´ˆê¸°í™” -->
                            <div style="display: flex; gap: 8px; justify-content: space-between; align-items: center;">
                                <div style="display: flex; gap: 8px;">
                                    <button id="admin-revert-base" class="btn-secondary" style="padding: 8px 12px; border-radius: 10px;">ê¸°ë³¸ëª¨ìŠµ</button>
                                </div>
                                <button id="admin-reset-btn" class="btn-danger hidden" style="padding: 8px 14px; border-radius: 10px;">ì´ˆê¸°í™” (ê´€ë¦¬ì)</button>
                            </div>
                        </div>
                    </div>
                    <!-- ê´€ë¦¬ì ì „ìš© ê°ì • ì ìˆ˜ í‘œì‹œ -->
                    <div id="emotion-scores" class="emotion-scores hidden">
                        <h3>ê°ì • ì ìˆ˜</h3>
                        <div class="emotion-grid">
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜Š</span>
                                <span class="emotion-name">ê¸°ì¨</span>
                                <span class="emotion-value" id="emotion-joy">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜¢</span>
                                <span class="emotion-name">ìŠ¬í””</span>
                                <span class="emotion-value" id="emotion-sadness">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜¡</span>
                                <span class="emotion-name">ë¶„ë…¸</span>
                                <span class="emotion-value" id="emotion-anger">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜°</span>
                                <span class="emotion-name">ë‘ë ¤ì›€</span>
                                <span class="emotion-value" id="emotion-fear">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜²</span>
                                <span class="emotion-name">ë†€ëŒ</span>
                                <span class="emotion-value" id="emotion-surprise">0</span>
                            </div>
                            <div class="emotion-item">
                                <span class="emotion-emoji">ğŸ˜–</span>
                                <span class="emotion-name">í˜ì˜¤</span>
                                <span class="emotion-value" id="emotion-disgust">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì˜¤ëŠ˜ì˜ íŒ (í™ˆ íƒ­ ì „ìš©) -->
                    <div class="tip-banner">
                        <span>ğŸ’¡</span>
                        <p id="daily-tip"></p>
                    </div>
                </div>
            </div>

            <!-- ì¼ê¸° í™”ë©´ -->
            <div id="diary-view" class="view">
                <div class="diary-container">
                    <h2>ì˜¤ëŠ˜ì˜ ê¸°ë¶„</h2>
                    <div class="emotion-selector">
                        <button class="emotion-btn" data-emotion="ê¸°ì¨">ğŸ˜Š</button>
                        <button class="emotion-btn" data-emotion="ìŠ¬í””">ğŸ˜¢</button>
                        <button class="emotion-btn" data-emotion="ë¶„ë…¸">ğŸ˜¡</button>
                        <button class="emotion-btn" data-emotion="ë‘ë ¤ì›€">ğŸ˜°</button>
                        <button class="emotion-btn" data-emotion="ë†€ëŒ">ğŸ˜²</button>
                        <button class="emotion-btn" data-emotion="í˜ì˜¤">ğŸ˜–</button>
                    </div>
                    <textarea id="diary-content" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë• ë‚˜ìš”? (ìµœì†Œ 20ì)" maxlength="1000"></textarea>
                    <div class="char-count"><span id="char-count">0</span></div>
                    <div class="diary-actions">
                        <button id="diary-cancel" class="btn-secondary">ì·¨ì†Œ</button>
                        <button id="diary-save" class="btn-primary" disabled>ì €ì¥</button>
                    </div>
                    <p class="error-msg" id="diary-error"></p>
                </div>
            </div>

            <!-- ëŒ€í™” í™”ë©´ -->
            <div id="chat-view" class="view">
                <div class="chat-container">
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                        <button id="chat-send">ì „ì†¡</button>
                    </div>
                </div>
            </div>

            <!-- ê²Œì„ ì„ íƒ í™”ë©´ -->
            <div id="game-view" class="view">
                <div class="game-selector">
                    <div class="game-card" id="target-game-card">
                        <h3>ğŸ¯ ê³¼ë… ë§ì¶”ê¸°</h3>
                        <p>ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ</p>
                        <p class="game-count">ì˜¤ëŠ˜ <span id="target-plays">0</span>/5 í”Œë ˆì´</p>
                        <button class="btn-primary">ì‹œì‘í•˜ê¸°</button>
                    </div>
                    <div class="game-card" id="puzzle-game-card">
                        <h3>ğŸ§© ìŠ¬ë¼ì´ë”© í¼ì¦</h3>
                        <p>ë§ˆìŒ ì±™ê¹€</p>
                        <p class="game-count">ì˜¤ëŠ˜ <span id="puzzle-plays">0</span>/5 í”Œë ˆì´</p>
                        <button class="btn-primary">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>

            <!-- ë§ˆì´í˜ì´ì§€ -->
            <div id="mypage-view" class="view">
                <div class="mypage-container">
                    <section class="profile-section">
                        <h2>í”„ë¡œí•„</h2>
                        <p>ë‹‰ë„¤ì„: <span id="user-nickname"></span></p>
                        <p>ìºë¦­í„°: <span id="character-name"></span></p>
                        <p>í•¨ê»˜í•œ ì§€ <span id="days-count">0</span>ì¼</p>
                    </section>
                    
                    <section class="stats-section">
                        <h2>í†µê³„</h2>
                        <p>ë ˆë²¨: <span id="stats-level">1</span></p>
                        <p>ì§„í™” ë‹¨ê³„: <span id="stats-evolution">0</span></p>
                        <p>ì´ ì¼ê¸°: <span id="stats-diaries">0</span>ê°œ</p>
                    </section>
                    
                    <section class="settings-section">
                        <h2>ì„¤ì •</h2>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="notification-toggle">
                                <span>ì•Œë¦¼ ë°›ê¸°</span>
                            </label>
                        </div>
                        <button id="logout-btn" class="btn-secondary" style="margin-top: 16px;">ë¡œê·¸ì•„ì›ƒ</button>
                    </section>
                    
                    <section class="diary-list-section">
                        <h2>ì¼ê¸° ëª©ë¡</h2>
                        <button id="load-diary-btn" class="btn-primary" style="margin-bottom: 16px; width: 100%;">ì¼ê¸° ëª©ë¡ ë³´ê¸°</button>
                        <div id="diary-list"></div>
                    </section>
                </div>
            </div>
            
            <!-- ìŒì‹ í™”ë©´ -->
            <div id="food-view" class="view">
                <div class="food-container">
                    <div class="food-header">
                        <h2>ğŸ½ï¸ ìŒì‹ ì¸ë²¤í† ë¦¬</h2>
                        <p class="food-count">ë³´ìœ : <span id="total-food-count">0</span>ê°œ</p>
                    </div>
                    
                    <div class="food-filter">
                        <button class="filter-btn active" data-filter="all">ì „ì²´</button>
                        <button class="filter-btn" data-filter="ê¸°ì¨">ğŸ˜Š ê¸°ì¨</button>
                        <button class="filter-btn" data-filter="ìŠ¬í””">ğŸ˜¢ ìŠ¬í””</button>
                        <button class="filter-btn" data-filter="ë¶„ë…¸">ğŸ˜¡ ë¶„ë…¸</button>
                        <button class="filter-btn" data-filter="ë‘ë ¤ì›€">ğŸ˜° ë‘ë ¤ì›€</button>
                        <button class="filter-btn" data-filter="ë†€ëŒ">ğŸ˜² ë†€ëŒ</button>
                        <button class="filter-btn" data-filter="í˜ì˜¤">ğŸ˜– í˜ì˜¤</button>
                    </div>
                    
                    <div id="food-grid" class="food-grid">
                        <!-- ë™ì ìœ¼ë¡œ ìŒì‹ ì¹´ë“œ ìƒì„± -->
                    </div>
                    
                    <div id="food-empty" class="food-empty hidden">
                        <p class="empty-icon">ğŸ½ï¸</p>
                        <p class="empty-text">ì•„ì§ ìŒì‹ì´ ì—†ì–´ìš”</p>
                        <p class="empty-hint">ê²Œì„ì„ í”Œë ˆì´í•´ì„œ ìŒì‹ì„ ì–»ì–´ë³´ì„¸ìš”!</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-view="home">
                <span>ğŸ </span>
                <span>í™ˆ</span>
            </button>
            <button class="nav-btn" data-view="diary">
                <span>ğŸ“</span>
                <span>ì¼ê¸°</span>
            </button>
            <button class="nav-btn" data-view="chat">
                <span>ğŸ’¬</span>
                <span>ëŒ€í™”</span>
            </button>
            <button class="nav-btn" data-view="game">
                <span>ğŸ®</span>
                <span>ê²Œì„</span>
            </button>
            <button class="nav-btn" data-view="mypage">
                <span>ğŸ‘¤</span>
                <span>ë§ˆì´</span>
            </button>
            <button class="nav-btn" data-view="food">
                <span>ğŸ½ï¸</span>
                <span>ìŒì‹</span>
            </button>
        </nav>
    </div>

    <!-- ëª¨ë‹¬ë“¤ -->
    <div id="modal-overlay" class="modal-overlay hidden"></div>
    
    <!-- ê²Œì„ ëª¨ë‹¬ -->
    <div id="game-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <div id="game-container"></div>
        </div>
    </div>

    <!-- ì¼ê¸° ìƒì„¸ ëª¨ë‹¬ -->
    <div id="diary-detail-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <div id="diary-detail-content"></div>
        </div>
    </div>

    <!-- ì•Œë¦¼ í† ìŠ¤íŠ¸ -->
    <div id="toast" class="toast hidden"></div>

    <!-- JavaScript íŒŒì¼ë“¤ (type="module"ë¡œ ë¡œë“œ) -->
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/character.js"></script>
    <script type="module" src="js/diary.js"></script>
    <script type="module" src="js/chat.js"></script>
    <script type="module" src="js/game-target.js"></script>
    <script type="module" src="js/game-puzzle.js"></script>
    <script type="module" src="js/food.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
